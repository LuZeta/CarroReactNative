{"ast":null,"code":"var _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\nvar _classCallCheck2 = _interopRequireDefault(require(\"@babel/runtime/helpers/classCallCheck\"));\nvar _createClass2 = _interopRequireDefault(require(\"@babel/runtime/helpers/createClass\"));\nvar _expoModulesCore = require(\"expo-modules-core\");\nvar _invariant = _interopRequireDefault(require(\"invariant\"));\nvar _reactNative = require(\"react-native\");\nfunction getBasePath(_ref) {\n  var httpServerLocation = _ref.httpServerLocation;\n  if (httpServerLocation[0] === '/') {\n    return httpServerLocation.substr(1);\n  }\n  return httpServerLocation;\n}\nfunction getScale() {\n  return _reactNative.Dimensions.get('window').scale;\n}\nfunction getScaledAssetPath(asset) {\n  var scale = AssetSourceResolver.pickScale(asset.scales, getScale());\n  var scaleSuffix = scale === 1 ? '' : '@' + scale + 'x';\n  var assetDir = getBasePath(asset);\n  return assetDir + '/' + asset.name + scaleSuffix + (asset.type ? \".\" + asset.type : '');\n}\nvar AssetSourceResolver = function () {\n\n  function AssetSourceResolver(serverUrl, jsbundleUrl, asset) {\n    (0, _classCallCheck2.default)(this, AssetSourceResolver);\n    this.serverUrl = serverUrl;\n    this.jsbundleUrl = jsbundleUrl;\n    this.asset = asset;\n  }\n  (0, _createClass2.default)(AssetSourceResolver, [{\n    key: \"isLoadedFromServer\",\n    value: function isLoadedFromServer() {\n      return !!this.serverUrl;\n    }\n  }, {\n    key: \"isLoadedFromFileSystem\",\n    value: function isLoadedFromFileSystem() {\n      return !!(this.jsbundleUrl && this.jsbundleUrl.startsWith('file://'));\n    }\n  }, {\n    key: \"defaultAsset\",\n    value: function defaultAsset() {\n      if (this.isLoadedFromServer()) {\n        return this.assetServerURL();\n      }\n      return this.scaledAssetURLNearBundle();\n    }\n  }, {\n    key: \"assetServerURL\",\n    value: function assetServerURL() {\n      (0, _invariant.default)(!!this.serverUrl, 'need server to load from');\n      return this.fromSource(this.serverUrl + getScaledAssetPath(this.asset) + '?platform=' + _expoModulesCore.Platform.OS + '&hash=' + this.asset.hash);\n    }\n  }, {\n    key: \"scaledAssetPath\",\n    value: function scaledAssetPath() {\n      return this.fromSource(getScaledAssetPath(this.asset));\n    }\n  }, {\n    key: \"scaledAssetURLNearBundle\",\n    value: function scaledAssetURLNearBundle() {\n      var path = this.jsbundleUrl || '';\n      return this.fromSource(path + getScaledAssetPath(this.asset));\n    }\n  }, {\n    key: \"resourceIdentifierWithoutScale\",\n    value: function resourceIdentifierWithoutScale() {\n      throw new _expoModulesCore.UnavailabilityError('react-native', 'resourceIdentifierWithoutScale()');\n    }\n  }, {\n    key: \"drawableFolderInBundle\",\n    value: function drawableFolderInBundle() {\n      throw new _expoModulesCore.UnavailabilityError('react-native', 'drawableFolderInBundle()');\n    }\n  }, {\n    key: \"fromSource\",\n    value: function fromSource(source) {\n      return {\n        __packager_asset: true,\n        width: this.asset.width,\n        height: this.asset.height,\n        uri: source,\n        scale: AssetSourceResolver.pickScale(this.asset.scales, getScale())\n      };\n    }\n  }], [{\n    key: \"pickScale\",\n    value: function pickScale(scales, deviceScale) {\n      for (var i = 0; i < scales.length; i++) {\n        if (scales[i] >= deviceScale) {\n          return scales[i];\n        }\n      }\n      return scales[scales.length - 1] || 1;\n    }\n  }]);\n  return AssetSourceResolver;\n}();\nexports.default = AssetSourceResolver;","map":{"version":3,"mappings":"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","names":["getBasePath","httpServerLocation","substr","getScale","Dimensions","get","scale","getScaledAssetPath","asset","AssetSourceResolver","pickScale","scales","scaleSuffix","assetDir","name","type","serverUrl","jsbundleUrl","startsWith","isLoadedFromServer","assetServerURL","scaledAssetURLNearBundle","fromSource","Platform","OS","hash","path","UnavailabilityError","source","__packager_asset","width","height","uri","deviceScale","i","length"],"sourceRoot":"","sources":["../src/AssetSourceResolver.web.ts"],"sourcesContent":["import { Platform, UnavailabilityError } from 'expo-modules-core';\nimport invariant from 'invariant';\nimport { Dimensions } from 'react-native';\n\ntype PackagerAsset = {\n  __packager_asset: boolean;\n  fileSystemLocation: string;\n  httpServerLocation: string;\n  width?: number;\n  height?: number;\n  scales: number[];\n  hash: string;\n  name: string;\n  type: string;\n};\n\nfunction getBasePath({ httpServerLocation }: PackagerAsset): string {\n  if (httpServerLocation[0] === '/') {\n    return httpServerLocation.substr(1);\n  }\n  return httpServerLocation;\n}\n\nexport type ResolvedAssetSource = {\n  __packager_asset: boolean;\n  width?: number;\n  height?: number;\n  uri: string;\n  scale: number;\n};\n\nfunction getScale(): number {\n  return Dimensions.get('window').scale;\n}\n\nfunction getScaledAssetPath(asset): string {\n  const scale = AssetSourceResolver.pickScale(asset.scales, getScale());\n  const scaleSuffix = scale === 1 ? '' : '@' + scale + 'x';\n  const assetDir = getBasePath(asset);\n  return assetDir + '/' + asset.name + scaleSuffix + (asset.type ? `.${asset.type}` : '');\n}\n\nexport default class AssetSourceResolver {\n  serverUrl?: string | null;\n  // where the jsbundle is being run from\n  jsbundleUrl?: string | null;\n  // the asset to resolve\n  asset: PackagerAsset;\n\n  constructor(\n    serverUrl: string | undefined | null,\n    jsbundleUrl: string | undefined | null,\n    asset: PackagerAsset\n  ) {\n    this.serverUrl = serverUrl;\n    this.jsbundleUrl = jsbundleUrl;\n    this.asset = asset;\n  }\n  isLoadedFromServer(): boolean {\n    return !!this.serverUrl;\n  }\n  isLoadedFromFileSystem(): boolean {\n    return !!(this.jsbundleUrl && this.jsbundleUrl.startsWith('file://'));\n  }\n  defaultAsset(): ResolvedAssetSource {\n    if (this.isLoadedFromServer()) {\n      return this.assetServerURL();\n    }\n\n    return this.scaledAssetURLNearBundle();\n  }\n  assetServerURL(): ResolvedAssetSource {\n    invariant(!!this.serverUrl, 'need server to load from');\n    return this.fromSource(\n      this.serverUrl +\n        getScaledAssetPath(this.asset) +\n        '?platform=' +\n        Platform.OS +\n        '&hash=' +\n        this.asset.hash\n    );\n  }\n  scaledAssetPath(): ResolvedAssetSource {\n    return this.fromSource(getScaledAssetPath(this.asset));\n  }\n  scaledAssetURLNearBundle(): ResolvedAssetSource {\n    const path = this.jsbundleUrl || '';\n    return this.fromSource(path + getScaledAssetPath(this.asset));\n  }\n  resourceIdentifierWithoutScale(): ResolvedAssetSource {\n    throw new UnavailabilityError('react-native', 'resourceIdentifierWithoutScale()');\n  }\n  drawableFolderInBundle(): ResolvedAssetSource {\n    throw new UnavailabilityError('react-native', 'drawableFolderInBundle()');\n  }\n  fromSource(source: string): ResolvedAssetSource {\n    return {\n      __packager_asset: true,\n      width: this.asset.width,\n      height: this.asset.height,\n      uri: source,\n      scale: AssetSourceResolver.pickScale(this.asset.scales, getScale()),\n    };\n  }\n\n  static pickScale(scales: number[], deviceScale: number): number {\n    for (let i = 0; i < scales.length; i++) {\n      if (scales[i] >= deviceScale) {\n        return scales[i];\n      }\n    }\n    return scales[scales.length - 1] || 1;\n  }\n}\n"]},"metadata":{},"sourceType":"script"}